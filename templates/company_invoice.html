<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>請求書</title>
  <style>
    @page {
      size: A4;
      margin: 20mm;
    }
    
    body {
      font-family: "Noto Sans JP", "Hiragino Sans", "ヒラギノ角ゴシック", "Yu Gothic Medium", "Yu Gothic", "メイリオ", "Meiryo", "MS PGothic", "MS Pゴシック", "Takao Gothic", "IPAexGothic", "IPAPGothic", "VL PGothic", "Noto Sans CJK JP", sans-serif;
      font-size: 8pt;
      margin: 0;
      padding: 20px;
      line-height: 1.4;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* 모든 요소에 Noto Sans JP 폰트 강제 적용 */
    * {
      font-family: "Noto Sans JP", "Hiragino Sans", "ヒラギノ角ゴシック", "Yu Gothic Medium", "Yu Gothic", "メイリオ", "Meiryo", "MS PGothic", "MS Pゴシック", "Takao Gothic", "IPAexGothic", "IPAPGothic", "VL PGothic", "Noto Sans CJK JP", sans-serif !important;
    }
    
    /* 1페이지는 세로 방향 */
    @page :first {
      size: A4 portrait;
      margin: 20mm;
    }
    
    /* 2페이지는 가로 방향 */
    @page {
      size: A4 landscape;
      margin: 15mm;
    }
    
    .page-break {
      page-break-before: always;
      page-break-after: always;
    }
    
    /* 1페이지 컨테이너 */
    .first-page {
      page-break-after: always;
      min-height: 100vh;
    }
    
    /* 2페이지 컨테이너 */
    .second-page {
      page-break-before: always;
      min-height: 100vh;
    }
    .header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      align-items: flex-start;
    }
    .recipient-info {
      line-height: 1.4;
    }
    .recipient-name {
      text-decoration: underline;
      text-underline-offset: 10px;
    }
    .sender-info {
      text-align: right;
      line-height: 1.4;
    }
    .title {
      text-align: center;
      font-size: 15pt;
      font-weight: bold;
      margin: 20px 0;
    }
    .invoice-date {
      text-align: right;
      margin-bottom: 20px;
    }
    .intro-message {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 8pt;
      border: 1px solid #000;  /* 겉 테두리선 추가 */
    }
    .invoice-table th,
    .invoice-table td {
      border-left: 1px solid #000;  /* 세로선 */
      border-right: 1px solid #000;  /* 세로선 */
      border-top: none;  /* 가로선 제거 */
      border-bottom: none;  /* 가로선 제거 */
      padding: 4px 8px;
      text-align: center;
      vertical-align: middle;
      height: auto;
    }
    .invoice-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      font-size: 8pt;
      height: auto;
      padding: 4px 8px;
    }
    .item-description {
      text-align: left;
      width: 40%;
    }
    .unit-price {
      width: 12%;
    }
    .quantity {
      width: 8%;
    }
    .tax-rate {
      width: 8%;
    }
    .tax-amount {
      width: 12%;
    }
    .amount-excluding-tax {
      width: 20%;
    }
    .summary-row {
      background-color: #f5f5f5;
      font-weight: bold;
      height: auto;
    }
    .summary-row td {
      height: auto;
      padding: 4px 8px;  /* 패딩 줄임 */
    }
    .summary-row .none-border {
      background-color: #fff;
      border-bottom: 0px solid #000;
      border-left: 0px solid #000;
    }
    .summary-row .item-description {
      text-align: right;
    }
    .item-description-left {
      text-align: left !important;
    }
    .expense-adjustment-row {
      height: 60px;  /* 박스 높이 설정 */
    }
    .expense-adjustment-row td {
      vertical-align: top;
      border-left: none;  /* 세로선 제거 */
      border-right: none;  /* 세로선 제거 */
    }
    .expense-adjustment-row .item-description-left {
      border-left: 1px solid #000;  /* 왼쪽 세로선만 유지 */
    }
    .expense-adjustment-row .amount-excluding-tax {
      border-right: 1px solid #000;  /* 오른쪽 세로선만 유지 */
    }
    .final-total-row {
      border: none;  /* 선 제거 */
      font-weight: bold;
    }
    .final-total-row td {
      border: none;  /* 선 제거 */
    }
    .final-total-row td:first-child {
      border: none;  /* 선 제거 */
    }
    .notes-section {
      margin-top: 50px;
      padding: 15px;
      border: 1px solid #000;
      line-height: 1.2;
    }
    .notes-section p {
      margin: 0 0 5px 0;
    }
    .notes-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .bank-info {
      margin-top: 15px;
    }
    .bank-info h3 {
      margin: 0 0 10px 0;
      font-size: 10pt;
      font-weight: bold;
    }
    .bank-info p {
      margin: 0 0 3px 0;
    }
    .payment-deadline {
      margin-top: 15px;
    }
    
    /* 2페이지 리스트 스타일 - 가로 형태 */
    .list-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 7pt;
      margin-bottom: 20px;
    }
    .list-table th,
    .list-table td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
      vertical-align: middle;
    }
    .list-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      font-size: 7pt;
    }
    .list-table .year-col { width: 5%; }
    .list-table .month-col { width: 5%; }
    .list-table .property-col { width: 15%; }
    .list-table .room-col { width: 5%; }
    .list-table .category-col { width: 5%; }
    .list-table .generation-col { width: 5%; }
    .list-table .name-col { width: 15%; }
    .list-table .workplace-col { width: 15%; }
    .list-table .rent-col { width: 8%; }
    .list-table .common-col { width: 8%; }
    .list-table .wifi-col { width: 7%; }
    .list-table .subtotal-col { width: 8%; }
    .list-table .name-cell {
      text-align: left;
    }
    .list-table .workplace-cell {
      text-align: left;
    }
    .list-table .amount-cell {
      text-align: right;
    }
    .list-table .total-row {
      background-color: #f5f5f5;
      font-weight: bold;
    }
    .list-table .total-row td {
      border-top: 2px solid #000;
    }
    .parent-header {
      background-color: #e0e0e0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- 1페이지: 청구서 -->
  <div class="first-page">
    <div class="header">
      <div class="recipient-info">
        {{ data.recipient_address }}<br><br>
        <strong><span class="recipient-name">{{ data.recipient_name }}</span></strong>
      </div>
      <div class="sender-info">
        {{ data.sender_name }}<br>
        {{ data.sender_address }}<br>
        TEL {{ data.sender_tel }} FAX {{ data.sender_fax }}<br>
        登録番号 {{ data.registration_number }}
      </div>
    </div>

    <div class="title">請 求 書</div>

    <div class="invoice-date">
      {{ data.invoice_date }}
    </div>

    <div class="intro-message">
      いつもお世話になっております。<br>
      以下ご請求させていただきますのでよろしくお願い申し上げます。
    </div>

    <table class="invoice-table">
      <thead>
        <tr>
          <th class="item-description">請求の項目</th>
          <th class="unit-price">単価</th>
          <th class="quantity">数量</th>
          <th class="tax-rate">税率</th>
          <th class="tax-amount">消費税額</th>
          <th class="amount-excluding-tax">税抜金額</th>
        </tr>
      </thead>
      <tbody>
        <!-- 카테고리별 표시 -->
        {% if data.categories %}
          {% for category in data.categories %}
            <tr>
              <td class="item-description">【{{ category.name }}】</td>
              <td class="unit-price"></td>
              <td class="quantity"></td>
              <td class="tax-rate"></td>
              <td class="tax-amount"></td>
              <td class="amount-excluding-tax"></td>
            </tr>
            <tr>
              <td class="item-description">家賃({{ category.billing_month }}月分)</td>
              <td class="unit-price">¥{{ "{:,}".format(category.total_rent + category.total_management) }}</td>
              <td class="quantity">1</td>
              <td class="tax-rate">非</td>
              <td class="tax-amount">-</td>
              <td class="amount-excluding-tax">¥{{ "{:,}".format(category.total_rent + category.total_management) }}</td>
            </tr>
            <tr>
              <td class="item-description">Wi-Fi代({{ category.billing_month }}月分)</td>
              <td class="unit-price">¥{{ "{:,}".format(category.total_wifi) }}</td>
              <td class="quantity">1</td>
              <td class="tax-rate">10%</td>
              <td class="tax-amount">¥{{ "{:,}".format(category.total_wifi_tax) }}</td>
              <td class="amount-excluding-tax">¥{{ "{:,}".format(category.total_wifi) }}</td>
            </tr>
          {% endfor %}
        {% endif %}
        
        <!-- 소계 행 -->
        <tr class="summary-row">
          <td class="item-description" colspan="5">小計</td>
          <td class="amount-excluding-tax">¥{{ "{:,}".format(data.subtotal) }}</td>
        </tr>
        
        <!-- 소비세 행 -->
        <tr class="summary-row">
          <td class="item-description" colspan="5">消費税額 10%</td>
          <td class="amount-excluding-tax">¥{{ "{:,}".format(data.tax_amount) }}</td>
        </tr>
        
        <!-- 실비정산 행 -->
        <tr class="expense-adjustment-row">
          <td class="item-description-left">【実費精算・その他】</td>
          <td class="unit-price"></td>
          <td class="quantity"></td>
          <td class="tax-rate"></td>
          <td class="tax-amount"></td>
          <td class="amount-excluding-tax"></td>
        </tr>
        
        <!-- 최종 청구금액 행 -->
        <tr class="summary-row">
          <td class="item-description" colspan="5">ご請求金額</td>
          <td class="amount-excluding-tax">¥{{ "{:,}".format(data.total_amount) }}</td>
        </tr>
      </tbody>
    </table>

    <div class="notes-section">
      <div class="notes-title">備考</div>
      
      <p>いつもお世話になっております。</p>
      <p>お手数ではございますが、お支払いは下記銀行口座へ振込くださいますようお願い申し上げます。</p>
      
      <div class="bank-info">
        <p>【振込先】</p>
        <p>{{ data.bank_name }} {{ data.branch_name }}支店 （{{ data.account_type }}） {{ data.account_number }}</p>
        <p>{{ data.account_holder }}</p>
        <p>※恐れ入りますが、振込手数料は貴社にてご負担ください。</p>
      </div>
      
      <div class="payment-deadline">
        お振込み期限 ： {{ data.payment_deadline }}
      </div>
    </div>
  </div>

  <!-- 2페이지: 상세 리스트 (가로 형태) -->
  <div class="second-page">
    <div class="title">居住者情報 詳細リスト</div>
    
    <table class="list-table">
      <thead>
        <tr>
          <th class="year-col" rowspan="2">年</th>
          <th class="month-col" rowspan="2">月</th>
          <th class="property-col" rowspan="2">物件名</th>
          <th class="parent-header" colspan="4">居住者情報</th>
          <th class="workplace-col" rowspan="2">勤務先</th>
          <th class="parent-header" colspan="4">家賃</th>
        </tr>
        <tr>
          <th class="room-col">部屋番号</th>
          <th class="category-col">区分</th>
          <th class="generation-col">○期生</th>
          <th class="name-col">氏名</th>
          <th class="rent-col">家賃</th>
          <th class="common-col">共益費</th>
          <th class="wifi-col">Wi-Fi</th>
          <th class="subtotal-col">小計</th>
        </tr>
      </thead>
      <tbody>
        {% for student in data.students %}
        <tr>
          <td class="year-col">{{ data.year }}</td>
          <td class="month-col">{{ student.billingMonth }}</td>
          <td class="property-col">{{ student.building_name }}</td>
          <td class="room-col">{{ student.room_number }}</td>
          <td class="category-col">{{ student.category }}</td>
          <td class="generation-col">{{ student.generation }}</td>
          <td class="name-cell name-col">{{ student.student_name }}</td>
          <td class="workplace-cell workplace-col">{{ student.company_name }}</td>
          <td class="amount-cell rent-col">¥{{ "{:,}".format(student.rent_amount) }}</td>
          <td class="amount-cell common-col">¥{{ "{:,}".format(student.management_fee) }}</td>
          <td class="amount-cell wifi-col">¥{{ "{:,}".format(student.wifi_amount) }}</td>
          <td class="amount-cell subtotal-col">¥{{ "{:,}".format(student.total_amount) }}</td>
        </tr>
        {% endfor %}
        
        <!-- 합계 행 -->
        <tr class="total-row">
          <td colspan="8">合計</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_rent) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_management) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_wifi) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_amount) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>