<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>請求書</title>
  <style>
    @font-face {
      font-family: "Noto Sans JP";
      src: url("static/fonts/NotoSansJP-Regular.ttf") format("opentype");
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: "Noto Sans JP", sans-serif;
      font-size: 10pt;
    }
    .header, .footer {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .right-text {
      text-align: right;
    }
    .line-height {
      line-height: 1.2;
    }
    .title {
      text-align: center;
      font-weight: bold;
      font-size: 18pt;
      margin: 30px 0;
    }
    .notice {
      margin-bottom: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 10px;
    }
    th, td {
      border: 1px solid black;
      padding: 6px;
      text-align: center;
    }
    .right {
      text-align: right;
    }
    .left {
      text-align: left;
    }
    .bold {
      font-weight: bold;
    }
    .note {
      font-size: 10pt;
      margin-top: 20px;
      border: 1px solid black;
      padding: 5px;
      min-height: 200px;
    }
    .box {
      border: 1px solid black;
      padding: 5px;
      margin-top: 10px;
    }
    .not-under-border-line {
      border-bottom: none;
    }
    /* 청구 상세 디자인 - 심플 버전 */
    .page {
      page-break-before: always;
      padding: 20px;
      background: white;
      min-height: 100vh;
    }
    .page h2 {
      text-align: center;
      font-size: 20pt;
      margin-bottom: 25px;
      border-bottom: 1px solid #000;
      padding-bottom: 8px;
    }
    .student-section {
      background: white;
      border: 1px solid #000;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .student-section h3 {
      margin: 0;
      padding: 15px 20px;
      font-size: 12pt;
      font-weight: bold;
      border-bottom: 2px solid #000;
      text-align: center;
      letter-spacing: 1px;
    }
    .student-section table {
      margin: 0;
      border-collapse: collapse;
      width: 100%;
    }
    .student-section th {
      padding: 10px 8px;
      text-align: center;
      font-weight: bold;
      font-size: 9pt;
      border: 1px solid #000;
    }
    .student-section td {
      padding: 8px;
      text-align: center;
      border: 1px solid #000;
      font-size: 7pt;
    }
    .amount-cell {
      font-weight: bold;
    }
    .memo-cell {
      text-align: left;
    }
  </style>
</head>
<body>

<div class="header line-height">
  <div>
    {{ data.recipient_address }}
  </div>
  <div class="right-text line-height">
    {{ data.sender_name }}<br>
    {{ data.sender_address }}<br>
    {{ data.sender_tel }}　{{ data.sender_fax }}<br>
    {{ data.registration_number }}
  </div>
</div>
<div style="display: inline-block; border-bottom: 2px solid #000; padding-bottom: 4px;">
　　　{{ data.recipient_name }}　　　　　　　　　
</div>
{% if data.recipient_address %}
<div style="margin-top: 5px;">
  {{ data.recipient_address }}
</div>
{% endif %}
<div class="title">請 求 書</div>
<div class="right-text">{{ data.invoice_date }}</div>

<div class="notice">
  いつもお世話になっております。<br>
  以下ご請求させていただきますのでよろしくお願い申し上げます。
</div>

<table>
  <tr>
    <th>請求の項目</th>
    <th>単価</th>
    <th>数量</th>
    <th>金額</th>
  </tr>
  <tr>
    <td style="border-bottom: none; border-top: none; text-align: left">請求名</td>
    <td style="border-bottom: none; border-top: none;" class="right">{{ "{:,}".format(data.total_amount) }}</td>
    <td style="border-bottom: none; border-top: none" class="right">1</td>
    <td style="border-bottom: none; border-top: none" class="right">{{ "{:,}".format(data.total_amount) }}</td>
  </tr>
  <tr>
    <td colspan="3" class="left" style="
      min-height: 100px;
      height: 100px;
      align-content: flex-start;
    ">
      【その他】<br>
      {{ data.memo|replace('\n', '<br>')|safe }}
    </td>
    <td class="right"></td>
  </tr>
  <tr>
    <td colspan="3" class="right bold" style="
      border-bottom: none;
      border-left:  none;
      padding: 0px;
    ">
      <span style="padding: 6px 35px 6px 20px; background: #d7d4d4;border-bottom: 1px solid black;border-left: 1px solid black;">ご請求金額</span>
    </td>
    <td class="right bold" style="background: #d7d4d4">{{ "{:,}".format(data.total_amount) }}</td>
  </tr>
</table>

<div class="note">
  参考
  <div style="padding-left:20px;">
  【その他】<br>
  【振込先】関西みらい銀行 八尾本町支店（普通）0041533<br>
  大阪医療介護協同組合（ｵｵｻｶｲﾘｮｳｶｲｺﾞｷｮｳﾄﾞｳｸﾐｱｲ）<br>
  恐れ入りますが、振込手数料は貴社にてご負担ください。
  </div>
</div>

<p style="margin-top: 30px;">お振込み期限：　{{ data.payment_deadline }}</p>

<div style="page-break-before: always;" class="page">
  <h2>請求詳細</h2>
  <table>
    <tr>
      <th>名前</th>
      <th>請求の項目</th>
      <th>単価</th>
    </tr>
    {% for invoice in data.invoice_list %}
      {% for item in invoice.invoice_items %}
      <tr>
        {% if loop.first %}
        <td rowspan="{{ invoice.invoice_items|length }}">{{ invoice.student_name|default('Unknown Student') }}</td>
        {% endif %}
        <td>{{ item.name|default('Unknown Item') }}</td>
        <td class="amount-cell">{{ "{:,}".format(item.unit_price|int) }}</td>
      </tr>
      {% endfor %}
      <tr style="font-weight: bold;">
        <td colspan="2" style="text-align: right;">{{ invoice.student_name|default('Unknown Student') }} 合計</td>
        <td class="amount-cell">{{ "{:,}".format(invoice.total_amount|int) }}</td>
      </tr>
    {% endfor %}
  </table>
</div>

</body>
</html>