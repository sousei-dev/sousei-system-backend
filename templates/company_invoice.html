<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>請求書</title>
  <style>
    @font-face {
      font-family: "Noto Sans JP";
      src: url("static/fonts/NotoSansJP-Regular.ttf") format("opentype");
      font-weight: normal;
      font-style: normal;
    }
    body {
      font-family: "Noto Sans JP", sans-serif;
      font-size: 8pt;
      margin: 0;
      padding: 20px;
      line-height: 1.4;
    }
    
    /* 1페이지는 세로 방향 */
    @page :first {
      size: A4 portrait;
    }
    
    /* 2페이지는 가로 방향 */
    @page {
      size: A4 landscape;
    }
    
    .page-break {
      page-break-before: always;
    }
    .header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      align-items: flex-start;
    }
    .recipient-info {
      line-height: 1.4;
    }
    .recipient-name {
      text-decoration: underline;
      text-underline-offset: 10px;
    }
    .sender-info {
      text-align: right;
      line-height: 1.4;
    }
    .title {
      text-align: center;
      font-size: 15pt;
      font-weight: bold;
      margin: 20px 0;
    }
    .invoice-date {
      text-align: right;
      margin-bottom: 20px;
    }
    .intro-message {
      margin-bottom: 20px;
      line-height: 1.6;
    }
    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      font-size: 8pt;
    }
    .invoice-table th,
    .invoice-table td {
      border: 1px solid #000;
      padding: 8px;
      text-align: center;
      vertical-align: middle;
      height: 30px;
    }
    .invoice-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      font-size: 8pt;
      height: auto;
      padding: 6px 8px;
    }
    .item-description {
      text-align: left;
      width: 30%;
    }
    .unit-price {
      width: 12%;
    }
    .quantity {
      width: 8%;
    }
    .tax-rate {
      width: 8%;
    }
    .tax-amount {
      width: 12%;
    }
    .amount-excluding-tax {
      width: 20%;
    }
    .summary-row {
      background-color: #f5f5f5;
      font-weight: bold;
      height: auto;
    }
    .summary-row td {
      height: auto;
      padding: 6px 8px;
    }
    .summary-row .none-border {
      background-color: #fff;
      border-bottom: 0px solid #000;
      border-left: 0px solid #000;
    }
    .summary-row .item-description {
      text-align: right;
    }
    .item-description-left {
      text-align: left !important;
    }
    .expense-adjustment-row {
      height: 90px;
    }
    .expense-adjustment-row td {
      vertical-align: top;
    }
    .final-total-row {
      border: 3px solid #000;
      font-weight: bold;
    }
    .final-total-row td {
      border-bottom: none;
      border-left: none;
    }
    .final-total-row td:first-child {
      border-left: 1px solid #000;
    }
    .notes-section {
      margin-top: 30px;
      padding: 15px;
      border: 1px solid #000;
      line-height: 1.2;
    }
    .notes-section p {
      margin: 0 0 5px 0;
    }
    .notes-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    .bank-info {
      margin-top: 15px;
    }
    .bank-info h3 {
      margin: 0 0 10px 0;
      font-size: 10pt;
      font-weight: bold;
    }
    .bank-info p {
      margin: 0 0 3px 0;
    }
    .payment-deadline {
      margin-top: 15px;
    }
    
    /* 2페이지 리스트 스타일 - 가로 형태 */
    .list-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 7pt;
      margin-bottom: 20px;
    }
    .list-table th,
    .list-table td {
      border: 1px solid #000;
      padding: 4px;
      text-align: center;
      vertical-align: middle;
    }
    .list-table th {
      background-color: #f0f0f0;
      font-weight: bold;
      font-size: 7pt;
    }
    .list-table .year-col { width: 5%; }
    .list-table .month-col { width: 5%; }
    .list-table .property-col { width: 15%; }
    .list-table .room-col { width: 5%; }
    .list-table .category-col { width: 5%; }
    .list-table .generation-col { width: 5%; }
    .list-table .name-col { width: 15%; }
    .list-table .workplace-col { width: 15%; }
    .list-table .rent-col { width: 8%; }
    .list-table .common-col { width: 8%; }
    .list-table .wifi-col { width: 7%; }
    .list-table .subtotal-col { width: 8%; }
    .list-table .name-cell {
      text-align: left;
    }
    .list-table .workplace-cell {
      text-align: left;
    }
    .list-table .amount-cell {
      text-align: right;
    }
    .list-table .total-row {
      background-color: #f5f5f5;
      font-weight: bold;
    }
    .list-table .total-row td {
      border-top: 2px solid #000;
    }
    .parent-header {
      background-color: #e0e0e0;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- 1페이지: 청구서 -->
  <div class="header">
    <div class="recipient-info">
      〒594-1157<br>
      大阪府和泉市あゆみ野1-7-1<br><br>
      <strong><span class="recipient-name">医療法人聖和錦秀会 阪和いずみ病院 御中</span></strong>
    </div>
    <div class="sender-info">
      株式会社 ミシマ<br>
      〒546-0003 大阪市東住吉区今川4-5-9-201<br>
      TEL 06-6760-7400 FAX 06-6760-7401<br>
      登録番号 T4120001018934
    </div>
  </div>

  <div class="title">請 求 書</div>

  <div class="invoice-date">
    2025年8月10日
  </div>

  <div class="intro-message">
    いつもお世話になっております。<br>
    以下ご請求させていただきますのでよろしくお願い申し上げます。
  </div>

  <table class="invoice-table">
    <thead>
      <tr>
        <th class="item-description">請求の項目</th>
        <th class="unit-price">単価</th>
        <th class="quantity">数量</th>
        <th class="tax-rate">税率</th>
        <th class="tax-amount">消費税額</th>
        <th class="amount-excluding-tax">税抜金額</th>
      </tr>
    </thead>
    <tbody>
      <!-- 빈 행들 - 실제 데이터가 들어갈 공간 -->
      <tr style="height: 200px;">
        <td class="item-description" style="vertical-align: top;"></td>
        <td class="unit-price"></td>
        <td class="quantity"></td>
        <td class="tax-rate"></td>
        <td class="tax-amount"></td>
        <td class="amount-excluding-tax"></td>
      </tr>
      
      <!-- 소계 행 - 한 줄로 합침 -->
      <tr class="summary-row">
        <td class="item-description" colspan="5">小計</td>
        <td class="amount-excluding-tax"></td>
      </tr>
      
      <!-- 소비세 행 - 한 줄로 합침 -->
      <tr class="summary-row">
        <td class="item-description" colspan="5">消費税額 10%</td>
        <td class="amount-excluding-tax"></td>
      </tr>
      
      <!-- 실비정산 행 - 한 줄로 합침 -->
      <tr class="expense-adjustment-row">
        <td class="item-description-left" colspan="5">【実費精算・その他】</td>
        <td class="amount-excluding-tax"></td>
      </tr>
      
      <!-- 최종 청구금액 행 - 실비정산 다음 줄에 추가 -->
      <tr class="summary-row">
        <td class="item-description none-border" colspan="4" style="border-bottom: 0px solid #000;"></td>
        <td class="item-description final-total-row">ご請求金額</td>
        <td class="amount-excluding-tax"></td>
      </tr>
    </tbody>
  </table>

  <div class="notes-section">
    <div class="notes-title">備考</div>
    
    <p>いつもお世話になっております。</p>
    <p>お手数ではございますが、お支払いは下記銀行口座へ振込くださいますようお願い申し上げます。</p>
    
    <div class="bank-info">
      <p>【振込先】</p>
      <p>関西みらい銀行 八尾本町支店 （普通） 0043448</p>
      <p>株式会社ミシマ</p>
      <p>※恐れ入りますが、振込手数料は貴社にてご負担ください。</p>
    </div>
    
    <div class="payment-deadline">
      お振込み期限 ： 8月31日
    </div>
  </div>

  <!-- 2페이지: 상세 리스트 (가로 형태) -->
  <div class="landscape-page">
    <div class="title">居住者情報 詳細リスト</div>
    
    <table class="list-table">
      <thead>
        <tr>
          <th class="year-col" rowspan="2">年</th>
          <th class="month-col" rowspan="2">月</th>
          <th class="property-col" rowspan="2">物件名</th>
          <th class="parent-header" colspan="4">居住者情報</th>
          <th class="workplace-col" rowspan="2">勤務先</th>
          <th class="parent-header" colspan="4">家賃</th>
        </tr>
        <tr>
          <th class="room-col">部屋番号</th>
          <th class="category-col">区分</th>
          <th class="generation-col">○期生</th>
          <th class="name-col">氏名</th>
          <th class="rent-col">家賃</th>
          <th class="common-col">共益費</th>
          <th class="wifi-col">Wi-Fi</th>
          <th class="subtotal-col">小計</th>
        </tr>
      </thead>
      <tbody>
        {% for student in data.students %}
        <tr>
          <td class="year-col">{{ data.year }}</td>
          <td class="month-col">{{ student.billingMonth }}</td>
          <td class="property-col">{{ student.building_name }}</td>
          <td class="room-col">{{ student.room_number }}</td>
          <td class="category-col">{{ student.category }}</td>
          <td class="generation-col">{{ student.generation }}</td>
          <td class="name-cell name-col">{{ student.student_name }}</td>
          <td class="workplace-cell workplace-col">{{ student.company_name }}</td>
          <td class="amount-cell rent-col">¥{{ "{:,}".format(student.rent_amount) }}</td>
          <td class="amount-cell common-col">¥{{ "{:,}".format(student.management_fee) }}</td>
          <td class="amount-cell wifi-col">¥{{ "{:,}".format(student.wifi_amount) }}</td>
          <td class="amount-cell subtotal-col">¥{{ "{:,}".format(student.total_amount) }}</td>
        </tr>
        {% endfor %}
        
        <!-- 합계 행 -->
        <tr class="total-row">
          <td colspan="8">合計</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_rent) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_management) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_wifi) }}</td>
          <td class="amount-cell">¥{{ "{:,}".format(data.total_amount) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</body>
</html>